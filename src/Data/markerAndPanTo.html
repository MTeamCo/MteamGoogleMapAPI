<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style type="text/css">
      html, body { 
	    overflow: hidden;
		height: 100%;
		width: 100%;
		margin: 0;
		padding: 0; 
		}
      #map {
		height: 100%; 
	  }
	  #preCenter{
		 position: relative;
		width:200px;
		height:20px;
		top:50%;
		margin: auto;
		
	
			
	  }
	  #preloader{
		
		border-style:solid;
		border-radius:3px;
		border-color: #666666;
		border-width:2px;
		background-color:#ECECEC
		
		
		
	  }
	  #preladerText{

		color: #333333;
		text-align:center;
		vertical-align: text-top;
	  }
	  

    </style>
	<!--img src="preloaders/Internet.gif" alt="Mountain View" style="width:64px;height:64px;position:absolute"-->
		
  </head>

  <body>
 <div id="preCenter"> 
	<div id="preloader">
		  <p id="preladerText">...درحال بارگذاری</p>
	</div>
</div>
   <div id="map"></div>
   
 <script type="text/javascript">
var map
var markers = [];
var pointArray = [];
var intM=false
var paramsObj
var fullScreen=false

var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
var labelIndex = 0;
var addLable
function setMarker(Marker_p)
{
	if(!paramsObj.showAllMarker)
	{
		setMapOnAll(null);
		markers = [];
	}
	
	var marker = new google.maps.Marker({
	map: map,
    position: Marker_p,
	label: addLable,
	title: Marker_p.title,
	icon: Marker_p.icon
  });
  markers.push(marker);
  
  if(paramsObj.backToMarker>-1)
  {
	map.addListener('center_changed', function() {
		// 3 seconds after the center of the map has changed, pan back to the
		// marker.
	window.setTimeout(function() {
		 map.panTo(marker.getPosition());
		}, paramsObj.backToMarker);
	});
  }

	marker.addListener('click', function()
	{	
	  if(paramsObj.zoomOnSelectMarker>-1)
		{
			map.setZoom(paramsObj.zoomOnSelectMarker);
			map.setCenter(marker.getPosition());
		}	
		if(paramsObj.sendMarkerSelected)
		{
			sendMarkerListByeSeletor(Marker_p)
		}
	});	
}


function label(loaction)
{
	if(paramsObj.outLabel)
	{
		addLable = labels[labelIndex++ % labels.length]
	}
	else
	{
		addLable = loaction.label
	}
}
function setMap(params) {
	document.getElementById("preCenter").style.visibility = "hidden";	
	document.getElementById("preCenter").style.position = "absolute";
	paramsObj = params
	pointArray = paramsObj.location
}
function runMap()
{

   
	if(paramsObj.sendButton)
	{
	var sendButton = document.getElementsByClassName("send")
    var t = document.createTextNode(paramsObj.sendBtnTitle);
	
	document.getElementById("sendText").appendChild(t);
	
	sendButton[0].style.backgroundColor ="#ffffff";
	sendButton[0].style.borderRadius  = "3px";
	
	sendButton[0].style.borderStyle="solid";
	sendButton[0].style.borderColor="rgba(0,0,0,0.3)";
	sendButton[0].style.borderTopStyle="none"
	sendButton[0].style.borderLeftStyle="none"
	sendButton[0].style.borderWidth="2px";


	sendButton[0].style.fontSize = "small";
	sendButton[0].style.font = "arial";
	document.getElementById("sendText").style.color = "#333333"
	sendButton[0].style.fontFamily = "Impact,Charcoal,sans-serif";		    
  
	sendButton[0].style.top = paramsObj.sendBtnY+"px";
	sendButton[0].style.left = paramsObj.sendBtnX+"px";
	sendButton[0].style.width = paramsObj.sendBtnWidth+"px"
	sendButton[0].style.height = paramsObj.sendBtnHeight+"px"
		
	sendButton[0].style.verticalAlign="center";
	sendButton[0].style.textAlign = "center";
	sendButton[0].style.position = "absolute";
	

	}

	if(paramsObj.fullScreenStatus)
	{	
	var fullScreenButton = document.getElementsByClassName("fullScreenId")
    var fullScreenText = document.createTextNode(paramsObj.fullScreenTitle);
	
	document.getElementById("fullScreenText").appendChild(fullScreenText);
	
	fullScreenButton[0].style.backgroundColor ="#ffffff";
	fullScreenButton[0].style.borderRadius  = "3px";
	
	fullScreenButton[0].style.borderStyle="solid";
	fullScreenButton[0].style.borderColor="rgba(0,0,0,0.3)";
	fullScreenButton[0].style.borderTopStyle="none"
	fullScreenButton[0].style.borderLeftStyle="none"
	fullScreenButton[0].style.borderWidth="2px";


	fullScreenButton[0].style.fontSize = "small";
	fullScreenButton[0].style.font = "arial";
	document.getElementById("fullScreenText").style.color = "#333333"
	fullScreenButton[0].style.fontFamily = "Impact,Charcoal,sans-serif";		    
  
	fullScreenButton[0].style.top = paramsObj.fullScreenBtnStyleY+"px";
	fullScreenButton[0].style.left = paramsObj.fullScreenBtnStyleX+"px";
	fullScreenButton[0].style.width = paramsObj.fullScreenBtnStyleWidth+"px"
	fullScreenButton[0].style.height = paramsObj.fullScreenBtnStyleHeight+"px"
		
	fullScreenButton[0].style.verticalAlign="center";
	fullScreenButton[0].style.textAlign = "center";
	fullScreenButton[0].style.position = "absolute";
	
	}
	
	var mapTypeId
	if(paramsObj.mapTypeId == "SATELLITE")
	{
		mapTypeId = google.maps.MapTypeId.SATELLITE
	}
	if(paramsObj.mapTypeId=="MAP")
	{
		mapTypeId = google.maps.MapTypeId.MAP
	}
	if(paramsObj.location.length>0)
	{
		//alert(paramsObj.location.length)
		var myLatLng = paramsObj.location[paramsObj.location.length-1]//{lat: paramsObj.lat, lng: paramsObj.lng};
		
		
	  // Create a map object and specify the DOM element for display.
		map = new google.maps.Map(document.getElementById('map'), {
		center: myLatLng,scrollwheel: paramsObj.scrollwheel,zoom: paramsObj.zoom,mapTypeId:mapTypeId});
	}

		
	if(paramsObj.marker)
	 {
		
		for (i=0;i<paramsObj.location.length;i++) 
		{
			
			label(paramsObj.location[i])
			setMarker(paramsObj.location[i])
			
			
		}
	 }
	
	map.addListener('click', function(e) 
	{
		placeMarkerAndPanTo(e.latLng);	
	});  

}
function placeMarkerAndPanTo(loaction) 
{
	label(loaction)
	if(paramsObj.markerAndPanTo)
	{
		var newMarker = {lat:loaction.lat(), lng:loaction.lng(),label:addLable,title:'',id:'',icon:''}
		pointArray.push(newMarker)
		setMarker(newMarker)
		var sendButton = document.getElementsByClassName("send")
		sendButton[0].style.backgroundColor ="#F60B31";
		document.getElementById("sendText").style.color = "#ffffff"
	}
	
	
  if(paramsObj.panTo)
  {
	 map.panTo(loaction);
  }
  
}

function setMapOnAll(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
}


// get change url
window.onhashchange = function() {
    var newHash = window.location.hash.substring(1);
	newHash = newHash.split("%22").join("\"")
	var params = JSON.parse(newHash);
	 setMap(params)	
};




// send new change url
function sendMarkerListByeSeletor(MarkerSelected_p)
{
	var locObj = {loaction:pointArray,seledted:MarkerSelected_p,fullScreen:paramsObj.fullScreen}
	var loactionStr = JSON.stringify(locObj)
	
	    document.location = (
      "?~" + encodeURIComponent(loactionStr));
}

function sendMarkerList()
{
	var locObj = {loaction:pointArray,seledted:null,fullScreen:paramsObj.fullScreen}
	var loactionStr = JSON.stringify(locObj)
	
	    document.location = (
      "?~" + encodeURIComponent(loactionStr));
}
function initMap() {
	
	//alert(paramsObj.mapTypeId)
	intM = true
}

cheker()
function cheker()
{
		window.setTimeout(function() {
		
		if(paramsObj!=undefined && intM)
		{
			runMap()
		}
		else
		{
			cheker()
		}
		
		}, 100);
}
function fullScreenFun()
{
	paramsObj.fullScreen = !paramsObj.fullScreen
	sendMarkerList()
}
 </script>
    <script id = "map" async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkbBuVTlafh74gzZnifaEL7cglAMv_Drs&callback=initMap">
    </script>

	
<table class="fullScreenId">
  <tr>
    <td <a onclick="fullScreenFun()" id="fullScreenText">&nbsp;</a></td>
  </tr>
</table>	
	
<table class="send">
  <tr>
    <td <a onclick="sendMarkerList()" id="sendText">&nbsp;</a></td>
  </tr>
</table>
  </body>
</html>